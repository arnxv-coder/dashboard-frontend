<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arnav’s Server Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body { font-family:'Inter',sans-serif; background:#1E2A38; color:#fff; transition:0.5s; }
  .sidebar { width:220px; background:#16222A; height:100vh; position:fixed; left:0; top:0; padding:1rem; }
  .sidebar h2 { color:#4A90E2; margin-bottom:2rem; cursor:pointer; transition:0.5s; }
  .sidebar a { display:block; color:#ccc; margin:0.5rem 0; text-decoration:none; }
  .main { margin-left:240px; padding:2rem; }
  .header { display:flex; justify-content:space-between; align-items:center; }
  .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-top:2rem; }
  .card { background:#233046; padding:1rem; border-radius:8px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,0.3); transition:0.3s; }
  .card:hover { transform:translateY(-5px); }
  .card h3 { margin-bottom:0.5rem; color:#4A90E2; }
  canvas { background:#1E2A38; border-radius:8px; }
  .footer { text-align:center; margin-top:2rem; color:#aaa; font-size:0.9rem; }
  button { background:#4A90E2; border:none; padding:0.5rem 1rem; border-radius:5px; color:#fff; cursor:pointer; }
  .logs-panel { margin-top:2rem; background:#233046; padding:1rem; border-radius:8px; max-height:200px; overflow-y:auto; }
  .log-entry { padding:0.2rem; border-bottom:1px solid #1E2A38; }
  .hidden { display:none; }
  input { width:100%; padding:0.5rem; margin-bottom:0.5rem; border-radius:5px; border:none; }
</style>
</head>
<body>

<div class="sidebar">
  <h2 id="logo">Arnxv</h2>
  <a href="#">Overview</a>
  <a href="#">Metrics</a>
  <a href="#">Processes</a>
  <a href="#">Network</a>
  <a href="#">Settings</a>
</div>

<div class="main">
  <div class="header">
    <h1>Arnav’s Server Dashboard</h1>
    <button onclick="toggleTheme()">Toggle Theme</button>
  </div>

  <div class="cards">
    <div class="card"><h3>CPU Usage</h3><p id="cpu">--%</p></div>
    <div class="card"><h3>RAM Usage</h3><p id="ram">--%</p></div>
    <div class="card"><h3>Disk Usage</h3><p id="disk">--%</p></div>
    <div class="card"><h3>Uptime</h3><p id="uptime">-- hours</p></div>
    <div class="card"><h3>Active Connections</h3><p id="connections">--</p></div>
  </div>

  <h2>CPU / RAM Over Time</h2>
  <canvas id="lineChart" height="100"></canvas>

  <h2>Network Activity</h2>
  <canvas id="networkChart" height="100"></canvas>

  <h2>HTTP Requests</h2>
  <canvas id="httpChart" height="100"></canvas>

  <h2>Top Processes</h2>
  <table id="processTable" border="1" cellpadding="5" style="width:100%; background:#233046; color:#fff; border-radius:5px;">
    <thead><tr><th>Name</th><th>CPU%</th><th>RAM%</th></tr></thead>
    <tbody></tbody>
  </table>

  <h2>Logs</h2>
  <input type="text" id="logFilter" placeholder="Search logs...">
  <div class="logs-panel" id="logsPanel"></div>

  <div class="footer">© 2025 Arnav | Mega Dashboard</div>
</div>

<script>
let lineChart, networkChart, httpChart;
let cpuData=[], ramData=[], netUpload=[], netDownload=[], httpData200=[], httpData400=[], httpData500=[], labels=[];

// Theme toggle + rainbow easter egg
let rainbow = false;
document.getElementById('logo').onclick = ()=>{ rainbow = !rainbow; toggleRainbow(); }
function toggleRainbow(){
  document.body.style.background = rainbow?'linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet)':'#1E2A38';
}

// Theme toggle
function toggleTheme(){
  document.body.style.background = document.body.style.background==='#1E2A38'?'#f4f7fc':'#1E2A38';
  document.body.style.color = document.body.style.color==='#fff'?'#333':'#fff';
}

// Fetch all data
async function fetchData(){
  const status = await fetch('https://dashboard-87s1.onrender.com/api/status').then(r=>r.json());
  const processes = await fetch('https://dashboard-87s1.onrender.com/api/processes').then(r=>r.json());
  const network = await fetch('https://dashboard-87s1.onrender.com/api/network').then(r=>r.json());
  const http = await fetch('https://dashboard-87s1.onrender.com/api/http').then(r=>r.json());
  const logs = await fetch('https://dashboard-87s1.onrender.com/api/logs').then(r=>r.json());

  // Update cards
  document.getElementById('cpu').textContent = status.cpu+'%';
  document.getElementById('ram').textContent = status.ram+'%';
  document.getElementById('disk').textContent = status.disk[0].used+'%';
  document.getElementById('uptime').textContent = status.uptime+' hours';
  document.getElementById('connections').textContent = network[0].operstate==='up'?'Active':'Inactive';

  // Top processes
  const tbody = document.getElementById('processTable').querySelector('tbody');
  tbody.innerHTML='';
  processes.forEach(p=>{
    const row=`<tr><td>${p.name}</td><td>${p.cpu}</td><td>${p.mem}</td></tr>`;
    tbody.innerHTML+=row;
  });

  // Logs filter
  const logsPanel = document.getElementById('logsPanel');
  logsPanel.innerHTML='';
  logs.forEach(log=>{
    logsPanel.innerHTML+=`<div class="log-entry">${log.time} - ${log.message}</div>`;
  });

  // Charts
  if(cpuData.length>10){ cpuData.shift(); ramData.shift(); netUpload.shift(); netDownload.shift(); labels.shift(); httpData200.shift(); httpData400.shift(); httpData500.shift();}
  cpuData.push(parseFloat(status.cpu)); ramData.push(parseFloat(status.ram));
  netUpload.push(network[0].tx_sec); netDownload.push(network[0].rx_sec);
  httpData200.push(http['200']); httpData400.push(http['400']); httpData500.push(http['500']);
  labels.push(new Date().toLocaleTimeString());

  if(!lineChart){
    const ctx = document.getElementById('lineChart').getContext('2d');
    lineChart = new Chart(ctx,{type:'line',data:{labels,datasets:[
      {label:'CPU %',data:cpuData,borderColor:'#4A90E2',fill:false},
      {label:'RAM %',data:ramData,borderColor:'#2ECC71',fill:false}
    ]},options:{responsive:true,animation:{duration:500}}});
  } else { lineChart.update(); }

  if(!networkChart){
    const ctx = document.getElementById('networkChart').getContext('2d');
    networkChart = new Chart(ctx,{type:'line',data:{labels,datasets:[
      {label:'Upload KB/s',data:netUpload,borderColor:'#F39C12',fill:false},
      {label:'Download KB/s',data:netDownload,borderColor:'#3498DB',fill:false}
    ]},options:{responsive:true,animation:{duration:500}}});
  } else { networkChart.update(); }

  if(!httpChart){
    const ctx = document.getElementById('httpChart').getContext('2d');
    httpChart = new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[
      {label:'200',data:httpData200,backgroundColor:'#2ECC71'},
      {label:'400',data:httpData400,backgroundColor:'#F1C40F'},
      {label:'500',data:httpData500,backgroundColor:'#E74C3C'}
    ]},options:{responsive:true,animation:{duration:500},scales:{x:{stacked:true},y:{stacked:true}}}});
  } else { httpChart.update(); }

  // Alerts for CPU/RAM/Disk
  ['cpu','ram','disk'].forEach(id=>{
    const val = parseFloat(document.getElementById(id).textContent);
    const card = document.getElementById(id).parentElement;
    if(val<50) card.style.background='#233046';
    else if(val<80) card.style.background='#F1C40F';
    else card.style.background='#E74C3C';
  });
}

// Logs filter input
document.getElementById('logFilter').addEventListener('input',(e)=>{
  const filter = e.target.value.toLowerCase();
  document.querySelectorAll('.log-entry').forEach(log=>{
    log.style.display=log.textContent.toLowerCase().includes(filter)?'block':'none';
  });
});

setInterval(fetchData,3000);
fetchData();
</script>
</body>
</html>
